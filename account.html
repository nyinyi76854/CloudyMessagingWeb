<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account</title>
    <style>
        body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.header {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    background-color: #f8f8f8;
}

.action-button {
    font-size: 24px;
    cursor: pointer;
    border: none;
    background: none;
}

.profile-section {
    text-align: center;
    margin-top: 20px;
}

.profile-image {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    object-fit: cover;
}

p {
    font-size: 18px;
    margin: 10px 0;
}

    </style>
</head>
<body>
    <div class="header">
        <button id="backButton" class="action-button">←</button>
        <h1>Account</h1>
        <button id="settingsButton" class="action-button">⚙</button>
    </div>

    <div class="profile-section">
        <img id="profileImageView" class="profile-image" src="placeholder.png" alt="Profile Photo">
        <p id="emailTextView">Email: </p>
        <p id="usernameTextView">Username: </p>
        <p id="regionTextView">Region: </p>
        <p id="genderTextView">Gender: </p>
        <p id="ageTextView">Age: </p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <script>
        // Your web app's Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyBcTEVvxXmv5N8dJav4xNDRy5hXZRjVeM4",
    authDomain: "chatflow-59776.firebaseapp.com",
    databaseURL: "https://chatflow-59776-default-rtdb.firebaseio.com",
    projectId: "chatflow-59776",
    storageBucket: "chatflow-59776.appspot.com",
    messagingSenderId: "549003131640",
    appId: "1:549003131640:web:3f4a7b8cef4c0d8a2b990d",
    measurementId: "G-V2180PR5CR"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const database = firebase.database();
const storage = firebase.storage();

// Get references to HTML elements
const profileImageView = document.getElementById('profileImageView');
const emailTextView = document.getElementById('emailTextView');
const usernameTextView = document.getElementById('usernameTextView');
const regionTextView = document.getElementById('regionTextView');
const genderTextView = document.getElementById('genderTextView');
const ageTextView = document.getElementById('ageTextView');

// Fetch user data
auth.onAuthStateChanged(user => {
    if (user) {
        const email = user.email;

        // Display email
        emailTextView.textContent = `Email: ${email}`;

        // Fetch and display user information from the database
        fetchUserInfo(email);
        fetchProfilePhoto(email);
    }
});

function fetchUserInfo(email) {
    const namesRef = database.ref('names');
    namesRef.orderByChild('email').equalTo(email).once('value').then(snapshot => {
        let latestName = '';
        let latestTimestamp = 0;
        snapshot.forEach(childSnapshot => {
            const timestamp = childSnapshot.child('timestamp').val();
            const name = childSnapshot.child('name').val();
            if (timestamp > latestTimestamp) {
                latestTimestamp = timestamp;
                latestName = name;
            }
        });
        usernameTextView.textContent = `Username: ${latestName || 'No username found'}`;
    });

    const locationRef = database.ref('location');
    locationRef.orderByChild('email').equalTo(email).once('value').then(snapshot => {
        snapshot.forEach(childSnapshot => {
            const continent = childSnapshot.child('continent').val();
            const country = childSnapshot.child('country').val();
            regionTextView.textContent = `Region: ${continent ? continent + '/' : ''}${country || 'Region not found'}`;
        });
    });

    const genderRef = database.ref('gender');
    genderRef.orderByChild('email').equalTo(email).once('value').then(snapshot => {
        snapshot.forEach(childSnapshot => {
            const gender = childSnapshot.child('gender').val();
            genderTextView.textContent = `Gender: ${gender || 'Unknown'}`;
        });
    });

    const usersRef = database.ref('users');
    usersRef.orderByChild('email').equalTo(email).once('value').then(snapshot => {
        snapshot.forEach(childSnapshot => {
            const age = childSnapshot.child('age').val();
            ageTextView.textContent = `Age: ${age || 'Unknown'}`;
        });
    });
}

function fetchProfilePhoto(email) {
    const profilesPhotoRef = database.ref('profilesphoto');
    profilesPhotoRef.once('value').then(snapshot => {
        let latestPhotoUrl = '';
        let latestTimestamp = 0;
        snapshot.forEach(childSnapshot => {
            const uploaderEmail = childSnapshot.child('uploaderEmail').val();
            const timestamp = childSnapshot.child('timestamp').val();
            const photoUrl = childSnapshot.child('downloadUrl').val();
            if (uploaderEmail === email && timestamp > latestTimestamp) {
                latestTimestamp = timestamp;
                latestPhotoUrl = photoUrl;
            }
        });
        if (latestPhotoUrl) {
            profileImageView.src = latestPhotoUrl;
        } else {
            profileImageView.src = 'placeholder.png';
        }
    });
}

// Back button click handler
document.getElementById('backButton').addEventListener('click', () => {
    window.history.back();
});

// Settings button click handler
document.getElementById('settingsButton').addEventListener('click', () => {
    window.location.href = 'settings.html';
});

    </script>
</body>
</html>
