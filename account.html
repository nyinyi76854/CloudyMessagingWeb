<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: #f8f8f8;
            border-bottom: 1px solid #ddd;
        }

        .header-button {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
        }

        .profile-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .profile-circle-image {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #ddd;
        }

        .info-section {
            margin-top: 20px;
        }

        .info-section p {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <button id="backButton" class="header-button">← Back</button>
        <button id="settingsButton" class="header-button">⚙️ Settings</button>
    </div>

    <div class="profile-section">
        <img id="profileImageView" class="profile-circle-image" src="placeholder-profile.png" alt="Profile Photo">
        <div class="info-section">
            <p id="emailTextView">Email: </p>
            <p id="usernameTextView">Username: </p>
            <p id="regionTextView">Region: </p>
            <p id="genderTextView">Gender: </p>
            <p id="ageTextView">Age: </p>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-storage.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBcTEVvxXmv5N8dJav4xNDRy5hXZRjVeM4",
            authDomain: "chatflow-59776.firebaseapp.com",
            databaseURL: "https://chatflow-59776-default-rtdb.firebaseio.com",
            projectId: "chatflow-59776",
            storageBucket: "chatflow-59776.appspot.com",
            messagingSenderId: "549003131640",
            appId: "1:549003131640:web:3f4a7b8cef4c0d8a2b990d",
            measurementId: "G-V2180PR5CR"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Firebase references
        const auth = firebase.auth();
        const database = firebase.database();
        

        document.addEventListener('DOMContentLoaded', function () {
            const user = auth.currentUser;
            if (user) {
                const email = user.email;

                // Load user profile photo
                const profileImageView = document.getElementById('profileImageView');
                const profileRef = database.ref('profilesphoto');
                profileRef.orderByChild('uploaderEmail').equalTo(email).once('value', snapshot => {
                    let latestPhotoUrl = null;
                    let latestTimestamp = 0;

                    snapshot.forEach(childSnapshot => {
                        const timestamp = childSnapshot.child('timestamp').val();
                        const photoUrl = childSnapshot.child('downloadUrl').val();

                        if (timestamp > latestTimestamp) {
                            latestTimestamp = timestamp;
                            latestPhotoUrl = photoUrl;
                        }
                    });

                    if (latestPhotoUrl) {
                        profileImageView.src = latestPhotoUrl;
                    } else {
                        profileImageView.src = 'placeholder-profile.png'; // Fallback image
                    }
                });

                // Load other user information
                const emailTextView = document.getElementById('emailTextView');
                const usernameTextView = document.getElementById('usernameTextView');
                const regionTextView = document.getElementById('regionTextView');
                const genderTextView = document.getElementById('genderTextView');
                const ageTextView = document.getElementById('ageTextView');

                database.ref('names').orderByChild('email').equalTo(email).once('value', snapshot => {
                    let userName = '';
                    snapshot.forEach(childSnapshot => {
                        const name = childSnapshot.child('name').val();
                        userName = name || email;
                    });
                    emailTextView.textContent = `Email: ${userName}`;
                });

                database.ref('usernameSet').orderByChild('email').equalTo(email).once('value', snapshot => {
                    snapshot.forEach(childSnapshot => {
                        const username = childSnapshot.child('username').val();
                        usernameTextView.textContent = `Username: ${username || 'No username found'}`;
                    });
                });

                database.ref('location').orderByChild('email').equalTo(email).once('value', snapshot => {
                    snapshot.forEach(childSnapshot => {
                        const continent = childSnapshot.child('continent').val();
                        const country = childSnapshot.child('country').val();
                        regionTextView.textContent = `Region: ${continent ? continent + '/' : ''}${country || 'Region not found'}`;
                    });
                });

                database.ref('gender').orderByChild('email').equalTo(email).once('value', snapshot => {
                    snapshot.forEach(childSnapshot => {
                        const gender = childSnapshot.child('gender').val();
                        genderTextView.textContent = `Gender: ${gender || 'Unknown'}`;
                    });
                });

                database.ref('users').orderByChild('email').equalTo(email).once('value', snapshot => {
                    snapshot.forEach(childSnapshot => {
                        const age = childSnapshot.child('age').val();
                        ageTextView.textContent = `Age: ${age || 'Unknown'}`;
                    });
                });
            }

            // Back button functionality
            document.getElementById('backButton').addEventListener('click', () => {
                window.history.back();
            });

            // Settings button functionality
            document.getElementById('settingsButton').addEventListener('click', () => {
                window.location.href = 'setting.html'; // Update with your settings page URL
            });
        });
    </script>
</body>
</html>
