<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #header {
            width: 100%;
            padding: 10px;
            position: fixed;
            top: 0;
            left: 0;
            background-color: #333;
            color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
        }

        #backButton, #settingsButton {
            color: #fff;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }

        #profile-section {
            text-align: center;
            margin-top: 60px; /* To position below the header */
        }

        #profileImage {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #ddd;
        }

        #info-section {
            margin-top: 20px;
            text-align: center;
        }

        #info-section p {
            margin: 10px 0;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div id="header">
        <button id="backButton"><i class="fas fa-arrow-left"></i></button>
        <button id="settingsButton"><i class="fas fa-cog"></i></button>
    </div>
    <div id="profile-section">
        <img id="profileImage" src="user_1077114.png" alt="Profile Photo">
    </div>
    <div id="info-section">
        <p><strong>Email:</strong> <span id="emailText">Loading...</span></p>
        <p><strong>Username:</strong> <span id="usernameText">Loading...</span></p>
        <p><strong>Age:</strong> <span id="ageText">Loading...</span></p>
        <p><strong>Region:</strong> <span id="regionText">Loading...</span></p>
        <p><strong>Gender:</strong> <span id="genderText">Loading...</span></p>
    </div>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js"></script>
    <script>
        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBLsBTQ1neD4-pZybjhMaMMr4X1Y7f9stc",
            authDomain: "cloudy-c02ac.firebaseapp.com",
            projectId: "cloudy-c02ac",
            storageBucket: "cloudy-c02ac.appspot.com",
            messagingSenderId: "729506856215",
            appId: "1:729506856215:web:06d56b828da9c6a72ccb52",
            measurementId: "G-1MQMPGL2TB"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();

        document.addEventListener("DOMContentLoaded", function() {
            const user = auth.currentUser;
            if (user) {
                const email = user.email;

                document.getElementById("emailText").textContent = email;

                // Fetch and display profile photo
                const profileImage = document.getElementById("profileImage");
                const profileRef = database.ref('profilesphoto');
                profileRef.orderByChild('timestamp').limitToLast(1).once('value').then(snapshot => {
                    let latestPhotoUrl = null;

                    snapshot.forEach(childSnapshot => {
                        const uploaderEmail = childSnapshot.child('uploaderEmail').val();
                        const photoUrl = childSnapshot.child('downloadUrl').val();

                        if (uploaderEmail === email) {
                            latestPhotoUrl = photoUrl;
                        }
                    });

                    if (latestPhotoUrl) {
                        profileImage.src = latestPhotoUrl;
                    } else {
                        profileImage.src = 'user_1077114.png';
                    }
                });

                // Fetch and display latest username
                const usernameRef = database.ref('usernameSet');
                usernameRef.orderByChild('email').equalTo(email).limitToLast(1).once('value').then(snapshot => {
                    let latestUsername = 'No username found';

                    snapshot.forEach(childSnapshot => {
                        const username = childSnapshot.child('username').val();
                        latestUsername = username || latestUsername;
                    });

                    document.getElementById("usernameText").textContent = latestUsername;
                });

                // Fetch and display latest age
                const ageRef = database.ref('users');
                ageRef.orderByChild('email').equalTo(email).limitToLast(1).once('value').then(snapshot => {
                    let latestAge = 'Unknown';

                    snapshot.forEach(childSnapshot => {
                        const age = childSnapshot.child('age').val();
                        latestAge = age || latestAge;
                    });

                    document.getElementById("ageText").textContent = latestAge;
                });

                // Fetch and display latest region
                const locationRef = database.ref('location');
                locationRef.orderByChild('email').equalTo(email).limitToLast(1).once('value').then(snapshot => {
                    let latestRegion = 'Region not found';

                    snapshot.forEach(childSnapshot => {
                        const continent = childSnapshot.child('continent').val();
                        const country = childSnapshot.child('country').val();
                        if (continent && country) {
                            latestRegion = `${continent}/${country}`;
                        }
                    });

                    document.getElementById("regionText").textContent = latestRegion;
                });

                // Fetch and display latest gender
                const genderRef = database.ref('gender');
                genderRef.orderByChild('email').equalTo(email).limitToLast(1).once('value').then(snapshot => {
                    let latestGender = 'Unknown';

                    snapshot.forEach(childSnapshot => {
                        const gender = childSnapshot.child('gender').val();
                        latestGender = gender || latestGender;
                    });

                    document.getElementById("genderText").textContent = latestGender;
                });
            }

            // Set up the click listener for the back button
            document.getElementById("backButton").addEventListener("click", function() {
                window.history.back();
            });

            // Set up the click listener for the settings button
            document.getElementById("settingsButton").addEventListener("click", function() {
                window.location.href = 'settings.html';
            });
        });
    </script>
</body>
</html>
